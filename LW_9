//Розробити та перевірити скалярну (scalar) функцію, що повертає загальну вартість книг виданих в певному році.
DROP FUNCTION sumBookPriceInYear
GO
CREATE FUNCTION dbo.sumBookPriceInYear (@year INT)
RETURNS FLOAT
AS
BEGIN
	DECLARE @sumprices FLOAT;
	SELECT @sumprices = SUM(price) FROM main, extra WHERE main.code = extra.code AND YEAR([date]) = @year
	RETURN @sumprices;
END;
GO
SELECT dbo.sumBookPriceInYear (1999)

//Розробити і перевірити табличну (inline) функцію, яка повертає список книг виданих в певному році.
GO
CREATE FUNCTION dbo.booksPubInYear(@year INT)
RETURNS TABLE
AS RETURN (SELECT main.code, main.title, main.price, extra.is_new, extra.publisher, extra.pages, extra.format, extra.date, extra.tirage, extra.topic, extra.category FROM main, extra WHERE main.code = extra.code AND YEAR([date])=@year);
GO
SELECT * from booksPublishedInYear(1999)

//Розробити і перевірити функцію типу multi-statement, яка буде:
//a.	приймати в якості вхідного параметра рядок, що містить список назв видавництв, розділених символом ‘;’;  
//b.	виділяти з цього рядка назву видавництва;
//c.	формувати нумерований список назв видавництв.
CREATE FUNCTION dbo.publisherList(@Input NVARCHAR(MAX))
RETURNS @result TABLE (Topic NVARCHAR(MAX)) AS
BEGIN
	DECLARE @temp NVARCHAR(MAX);
	IF (RIGHT(@Input,1)<>';') SET @Input=CONCAT(@Input, ';');
	WHILE CHARINDEX(';', @Input)>0
	BEGIN
		SET @temp=REPLACE(SUBSTRING(@Input, 1, CHARINDEX(';', @Input)), ';', '');
		INSERT INTO @result (Topic) VALUES (@temp);
		SET @Input = REPLACE(@Input, @temp+';', '');
	END;
	RETURN;
END;
USE shop
GO
SELECT string_agg([publishers], ';')
FROM publishers

//Виконати набір операцій по роботі з SQL курсором: оголосити курсор;
//a.	використовувати змінну для оголошення курсору;
//b.	відкрити курсор;
//c.	переприсвоїти курсор іншої змінної;
//d.	виконати вибірку даних з курсору;
//e.	закрити курсор;


//Звільнити курсор. Розробити курсор для виводу списка книг виданих у визначеному році.
